#!/usr/bin/env zsh
#===============================================================================
# vde-logs - Show logs for a VDE container
# Usage: vde-logs <vm_name> [options]
#
# Options:
#   -f, --follow    Follow log output
#   --tail N        Show last N lines (default: 50)
#===============================================================================

# Determine VDE root directory
VDE_ROOT_DIR="${0:a:h:h}"
export VDE_ROOT_DIR

# Source core libraries
[[ -f "$VDE_ROOT_DIR/scripts/lib/vde-shell-compat" ]] && source "$VDE_ROOT_DIR/scripts/lib/vde-shell-compat" &>/dev/null
[[ -f "$VDE_ROOT_DIR/scripts/lib/vde-constants" ]] && source "$VDE_ROOT_DIR/scripts/lib/vde-constants" &>/dev/null
[[ -f "$VDE_ROOT_DIR/scripts/lib/vde-errors" ]] && source "$VDE_ROOT_DIR/scripts/lib/vde-errors" &>/dev/null

# Check arguments
if [ -z "$1" ]; then
    vde_error_simple "VM name is required"
    echo "Usage: vde-logs <vm_name> [options]"
    exit $VDE_ERR_INVALID_INPUT
fi

VM_NAME="$1"
shift

# Parse options
TAIL="50"
FOLLOW=0

while [[ $# -gt 0 ]]; do
    case "$1" in
        -f|--follow)
            FOLLOW=1
            shift
            ;;
        --tail)
            TAIL="$2"
            shift 2
            ;;
        *)
            shift
            ;;
    esac
done

# Run docker logs
if [ $FOLLOW -eq 1 ]; then
    docker logs --tail "$TAIL" -f "$VM_NAME"
else
    docker logs --tail "$TAIL" "$VM_NAME"
fi

exit 0
