#!/usr/bin/env zsh
# install-githooks - Install VDE git hooks
#
# Installs project git hooks from scripts/githooks/ to .git/hooks/

set -e

SCRIPT_DIR="$(cd "$(dirname "$0")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"
HOOKS_DIR="$PROJECT_ROOT/.git/hooks"
SOURCE_DIR="$PROJECT_ROOT/scripts/githooks"

# Colors
GREEN='\033[0;32m'
YELLOW='\033[0;33m'
RED='\033[0;31m'
RESET='\033[0m'

echo "Installing VDE git hooks..."

# Check if we're in a git repository
if [[ ! -d "$HOOKS_DIR" ]]; then
    echo -e "${RED}Error: Not in a git repository${RESET}"
    exit 1
fi

# Check if source hooks exist
if [[ ! -d "$SOURCE_DIR" ]]; then
    echo -e "${YELLOW}Warning: No hooks to install in $SOURCE_DIR${RESET}"
    exit 0
fi

# Install each hook
INSTALLED=0
for hook in "$SOURCE_DIR"/*; do
    if [[ -f "$hook" ]]; then
        hook_name=$(basename "$hook")
        target="$HOOKS_DIR/$hook_name"

        # Remove existing hook
        if [[ -e "$target" ]]; then
            rm -f "$target"
        fi

        # Create symlink
        ln -sf "../../scripts/githooks/$hook_name" "$target"
        chmod +x "$target"

        echo -e "  ${GREEN}âœ“${RESET} Installed: $hook_name"
        ((INSTALLED++))
    fi
done

if [[ $INSTALLED -eq 0 ]]; then
    echo -e "${YELLOW}No hooks found to install${RESET}"
else
    echo ""
    echo -e "${GREEN}Successfully installed $INSTALLED git hook(s)${RESET}"
    echo ""
    echo "Installed hooks:"
    echo "  - pre-commit: Blocks deletion of protected config files"
fi
